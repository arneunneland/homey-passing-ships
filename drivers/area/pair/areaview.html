<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="../../../assets/vue.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="../../../assets/leaflet.geometryutil.js"></script>
<script src="../../../assets/leaflet.snap.js"></script>


<style>
  #map { height: 250px; }
</style>
<script>

  console.log('start');
  Homey.setTitle("Velg område");
  Homey.emit('getArea', null)
    .then(data => {
      console.log('readystartvue');
      new Vue({
        el: "#area",
        data: {},
        mounted() {
          console.log('readyGO');
          setTimeout(() => {
            //https://leafletjs.com/examples/quick-start/
            var map = L.map('map').setView([62.4722, 6.1495], 11);
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 15,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            var drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);
            var guideLayers = new Array();
                var drawnItems = new L.FeatureGroup();
                map.addLayer(drawnItems);
            var drawControl = new L.Control.Draw({
            position: 'topright',
            draw: {
                polyline: false,
                polygon: {
                    shapeOptions: {
                        color: '#009900'
                    }
                },
                circle: false, // Turns off this drawing tool
                rectangle: false,
                marker: false
                  },
                edit: {
                featureGroup: drawnItems, //REQUIRED!!
                remove: true
                }
                    });
                map.addControl(drawControl);


            // Editing lines works fine on the sample (http://makinacorpus.github.io/Leaflet.Snap/) but not below.

              drawControl.setDrawingOptions({
                    polygon: { guideLayers: guideLayers, snapDistance: 15 },
              });

                map.on('draw:created', function (e) {
                    var layer = e.layer;
                    drawnItems.addLayer(layer);
                    guideLayers.push(layer);

                });
          }, 1000)
          
        },
        methods: {
          characteristics() {
            Homey.emit("updateArea", this.device).catch(error => { console.log(error) });
          }
        }
      });
      
  
    }).catch(error => {
      console.log(error);
      return;
    });
    console.log('ready2');
</script>

<div id="area">
  <h3>Velg område</h3>
  
  <div id="map"></div>
</div>